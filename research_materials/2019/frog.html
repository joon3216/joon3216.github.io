<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Junkyu Park" />


<title>Frog simulation:   a finite state space and a Marcov chain</title>

<link href="frog_files/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="frog_files/pagedtable-1.1/js/pagedtable.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-139050237-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-139050237-1');
</script>
<!-- <link rel="stylesheet" type="text/css" href="all_navbar_style_3.css"> -->
<style type="text/css">
body
{
    margin: 0;
    padding: 0;
    font-family: sans-serif;
}
nav
{
    position: sticky; /* old: fixed */
    top: 0;
    left : 0;
    width: 100%;
    height: 50px;
    padding: 5px 30px; /* old: 10px 100px */
    box-sizing: border-box;
    transition: .5s;
    background: rgba(28, 44, 56, 0.99); /* new: Added */
    border-bottom: 1px solid #EAEAEB;
}
nav .menu ul
{
    float: left; /* old: right */
    margin: 0 10px;
    padding: 0;
    display: flex;
}
nav .menu ul li
{
    list-style: none;
    /*position: sticky;*/
}
nav .menu ul li a
{
    line-height: 40px;
    color: #f7ecec; /* old: #262626 */
    padding: 0 10px;
    font-family: sans-serif;
    transition: .5s;
    /*display: block;*/
}
nav label
{
    margin: 0;
    padding: 5px 25px;
    font-size: 26px;
    line-height: 40px;
    display: none;
    width: 26px;
    float: right;
    color: #f7ecec;
}
nav.black label
{
    transition: .5s;
}
nav #toggle
{
    display: none;
}
@media only screen and (max-width: 550px) 
{
    nav label
    {
        line-height: 26px;
        display: block;
        cursor: pointer;
        float: right;
    }
    nav.black label
    {
        font-size: 26px;
        margin: 0;
        padding: 0px 25px;
    }
    nav .menu
    {
        float: right;
        text-align: center;
        width: 100vw;
        display: none;
        padding: 0 0 0 30px;
    }
    nav.black .menu
    {
        float: right;
        text-align: center;
        width: 100vw;
        display: none;
        padding: 0 0 0 25px;
    }
    nav .menu ul
    {
        display: block;
        margin: 0;
        padding: 0;
        background: rgba(28, 44, 56, 0.99);
        width: 100vw;
        height: 35vh;
    }
    nav.black .menu ul
    {
        background: rgb(21, 92, 148);
        margin: 0;
        padding: 0;
        width: 100vw;
        height: 22vh;
    }
    nav .menu ul li a
    {
        margin: 0;
        display: block;
        border-bottom: 1px solid #EAEAEB;
    }
    nav.black .menu ul li a
    {
        margin: 0;
        display: block;
        border-bottom: 1px solid #EAEAEB;
    }
    nav #toggle:checked + .menu
    {
        display: block;
        width: 100vw;
        height: 250%;
    }
}
nav.black
{
    background: rgba(21, 92, 148, .7); /* old: .8*/
    height: 50px;
    padding: 10px 25px; /* old: 10px 50px */
}
nav .logo
{
    float: left;
}
nav .logo img
{
    height: 40px;
    transition: .5s;
}
nav.black .logo img
{
    height: 30px;
}
nav.black .menu ul li a
{
    color: #f7ecec; /* old: rbg(0, 0, 0); */
    line-height: 30px;
}
nav .menu ul li a:hover
{
    color: #fff; /* old: #fff; */
    background: rgba(21, 92, 148, 0.01); /* old: 0.01 */
}
nav.black .menu ul li a:hover
{
    color: rgb(0, 0, 0); /* old: #fff; */
    background: rgba(21, 92, 148, 0.01); /* old: 0.01 */
}
</style>

<script src="https://code.jquery.com/jquery-3.2.1.js"></script>
<script type="text/javascript">
    $(window).on('scroll', function(){
        if ($(window).scrollTop()){
            $('nav').addClass('black');
        }
        else
        {
            $('nav').removeClass('black');
        }
    })
</script>
<link rel="icon" href="../../style/all_orange_jp.png">


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link rel="stylesheet" href="frog_files/style.css" type="text/css" />

</head>

<body>


<nav>
    <div class="logo">
        <a href="../../index.html">
            <img src="../../style/all_orange_jp.png">
        </a>
    </div>
    <label for="toggle">&#9776;</label>
    <input type="checkbox" id="toggle"/>
    <div class="menu">
        <ul>
            <li><a href="../../cv.html">About</a></li>
            <li><a href="../../projects.html">Projects</a></li>
            <li><a href="../../research_materials.html">Research materials</a></li>
            <li><a href="../../news.html">News</a></li>
        </ul>
    </div>
</nav>


<section class="page-header">
<h1 class="title toc-ignore project-name">Frog simulation: <br> a finite state space and a Marcov chain</h1>
<h4 class="author project-author">Junkyu Park</h4>
</section>


<div id="TOC" class="toc">
<ul>
<li><a href="#introduction">1. Introduction</a></li>
<li><a href="#a-jumping-frog">2. A jumping frog</a></li>
<li><a href="#session-info">Session info</a></li>
</ul>
</div>

<section class="main-content">
<p>The following external R packages are used:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
<span class="kw">library</span>(gganimate) <span class="co"># &#39;gifski&#39; and &#39;png&#39; package have to be installed</span>
<span class="kw">library</span>(tidyr)
include_graphics &lt;-<span class="st"> </span>knitr<span class="op">::</span>include_graphics</code></pre></div>
<div id="introduction" class="section level1">
<h1>1. Introduction</h1>
<p>This is to illustrate the “jumping frog” Markov chain <a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> using <code>gganimate</code> package.</p>
</div>
<div id="a-jumping-frog" class="section level1">
<h1>2. A jumping frog</h1>
<p>Say there is a frog jumping across 20 lily pads numbered from 1 to 20 which are arranged clockwise in a circle. Suppose <span class="math inline">\(X_n\)</span> is the pad number at the <span class="math inline">\(n\)</span><sup>th</sup> jump. Let’s define the “jumping frog” Markov chain <span class="math inline">\(\{ X_n \}_{n = 0}^{\infty}\)</span> as a Markov chain whose state space is <span class="math inline">\(S = \{ 1, 2, \dots, 20\}\)</span>, with the initial state <span class="math inline">\(X_0 = 20\)</span> and initial probabilities <span class="math inline">\(v_{20} = P(X_0 = 20) = 1\)</span> and <span class="math inline">\(v_s = 0 \text{ }\)</span> for all <span class="math inline">\(s = 1, \dots, 19\)</span>, and trainsition probabilities <span class="math inline">\(p_{ij} = P(X_n = j \text{ | } X_{n - 1} = i)= \frac{1}{3}\)</span> whenever <span class="math inline">\(j = i - 1, i\)</span>, or <span class="math inline">\(i + 1\)</span>.</p>
<p>Long story short, a <a href="http://probability.ca/jeff/java/frogwalk.html">Java Applet regarding this frogwalk</a> written by <a href="http://probability.ca/jeff/">Prof. Rosenthal</a> at the University of Toronto doesn’t work anymore. This is the effort to simulate this Markov chain using R and <code>gganimate</code> package.</p>
<p>With initial parameters below, we can simulate this Markov chain and populate <code>X</code> with some generated <span class="math inline">\(X_n\)</span>’s:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1024</span>)

<span class="co"># Settings</span>
max_iter &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="co"># The maximum n</span>
number_of_pads &lt;-<span class="st"> </span><span class="dv">20</span>
initial_state &lt;-<span class="st"> </span><span class="dv">20</span>
p_ij =<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">3</span>) <span class="op">/</span><span class="st"> </span><span class="dv">3</span> <span class="co"># Prob of moving left, staying, and moving right</span>

<span class="co"># Populate X</span>
state_space &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span>number_of_pads
cmf_p_ij =<span class="st"> </span><span class="kw">cumsum</span>(p_ij)
X &lt;-<span class="st"> </span><span class="ot">NULL</span>
X[<span class="dv">1</span>] &lt;-<span class="st"> </span>state_space[initial_state] <span class="co"># initial state</span>
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>(max_iter <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)) {
    choice &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>) <span class="co"># choice ~ Unif(0, 1)</span>
    <span class="cf">if</span> (<span class="dv">0</span> <span class="op">&lt;=</span><span class="st"> </span>choice <span class="op">&amp;&amp;</span><span class="st"> </span>choice <span class="op">&lt;</span><span class="st"> </span>cmf_p_ij[<span class="dv">1</span>]) { <span class="co"># move left</span>
        <span class="cf">if</span> (X[i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>] <span class="op">==</span><span class="st"> </span>number_of_pads) {
            X[i] &lt;-<span class="st"> </span><span class="dv">1</span>
        } <span class="cf">else</span> {
            X[i] &lt;-<span class="st"> </span>X[i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>] <span class="op">+</span><span class="st"> </span><span class="dv">1</span> 
        }
    } <span class="cf">else</span> <span class="cf">if</span> (cmf_p_ij[<span class="dv">1</span>] <span class="op">&lt;=</span><span class="st"> </span>choice <span class="op">&amp;&amp;</span><span class="st"> </span>choice <span class="op">&lt;</span><span class="st"> </span>cmf_p_ij[<span class="dv">2</span>]) { <span class="co"># stay</span>
        X[i] &lt;-<span class="st"> </span>X[i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>]
    } <span class="cf">else</span> { <span class="co"># move right</span>
        <span class="cf">if</span> (X[i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>] <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) {
            X[i] &lt;-<span class="st"> </span>number_of_pads
        } <span class="cf">else</span> {
            X[i] &lt;-<span class="st"> </span>X[i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>] <span class="op">-</span><span class="st"> </span><span class="dv">1</span>
        }
    }
}</code></pre></div>
<p><code>state_df</code> will be used to create a tibble that indicates the pad number the frog is located at each iteration. <code>state_space</code> will be used as x-axis, <code>pads_point</code> as y-axis (which is just a dummy), and <code>iterations</code> as a facetting variable:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">state_df &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">iterations =</span> <span class="kw">rep</span>(
    <span class="dv">0</span><span class="op">:</span>max_iter, 
    <span class="dt">each =</span> number_of_pads
  ),
  <span class="dt">state_space =</span> <span class="kw">rep</span>(state_space, max_iter <span class="op">+</span><span class="st"> </span><span class="dv">1</span>),
  <span class="dt">pads_point =</span> <span class="kw">rep</span>(<span class="dv">1</span>, number_of_pads <span class="op">*</span><span class="st"> </span>(max_iter <span class="op">+</span><span class="st"> </span><span class="dv">1</span>))
)</code></pre></div>
<p><code>comparison_df</code> is a tibble that acutally indicates where the frog is at at each iteration. <code>state_space</code> and <code>iterations</code> will be variables that <code>state_df</code> and <code>comparison_df</code> have in common, and <code>value</code> will be an indicator:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">comparison_df &lt;-<span class="st"> </span><span class="kw">tibble</span>(state_space)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(max_iter <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)) {
  mutating_code &lt;-<span class="st"> </span><span class="kw">paste0</span>(
    <span class="st">&quot;comparison_df &lt;- comparison_df %&gt;% &quot;</span>,
    <span class="st">&quot;mutate(`&quot;</span>, i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;` = state_space == X[i])&quot;</span>
  )
  <span class="kw">eval</span>(<span class="kw">parse</span>(<span class="dt">text =</span> mutating_code))
}
comparison_df &lt;-<span class="st"> </span>comparison_df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">gather</span>(iterations, value, <span class="op">-</span>state_space) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">iterations =</span> <span class="kw">as.integer</span>(iterations))</code></pre></div>
<p>We shall now <code>left_join</code> <code>state_df</code> and <code>comparison_df</code> using <code>state_space</code> and <code>iterations</code> columns, and create the whole <code>states_df</code> that is ready for generating a .gif file:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">states_df &lt;-<span class="st"> </span>state_df <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">left_join</span>(comparison_df, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;state_space&quot;</span>, <span class="st">&quot;iterations&quot;</span>))</code></pre></div>
<p>In our <code>gganimate</code> usage, we are basically creating a fast slide show of all the facets. <code>iterations</code> is our facetting variable, which is used in <code>transition_states</code>. Whenever the frog is located at the pad, the image will denote such a state with a red dot, and the rest of the pads will be coloured as black.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">anim &lt;-<span class="st"> </span><span class="kw">ggplot</span>(
    states_df, 
    <span class="kw">aes</span>(
        <span class="dt">x =</span> <span class="kw">factor</span>(state_space), <span class="dt">y =</span> pads_point, 
        <span class="dt">color =</span> value
    )
) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">coord_polar</span>(<span class="dt">start =</span> .<span class="dv">15</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Iteration: {frame_time}&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">transition_time</span>(iterations) <span class="op">+</span>
<span class="st">    </span><span class="kw">enter_drift</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">exit_drift</span>()
states_gif &lt;-<span class="st"> </span><span class="kw">animate</span>(
  anim, <span class="dt">fps =</span> <span class="dv">20</span>,
  <span class="dt">duration =</span> <span class="dv">78</span>,
  <span class="dt">start_pause =</span> <span class="dv">2</span>,
  <span class="dt">end_pause =</span> <span class="dv">2</span>
)
<span class="kw">anim_save</span>(<span class="st">&#39;frog.gif&#39;</span>, states_gif)</code></pre></div>
<p>Here’s the .gif file:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">include_graphics</span>(<span class="st">&#39;frog.gif&#39;</span>)</code></pre></div>
<p><img src="frog.gif" style="display: block; margin: auto;" /></p>
<p>Here’s a slower version (it takes a bit of time to load… 6 seconds?):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">states_gif2 &lt;-<span class="st"> </span><span class="kw">animate</span>(
  anim, <span class="dt">fps =</span> <span class="dv">20</span>,
  <span class="dt">duration =</span> <span class="dv">226</span>,
  <span class="dt">start_pause =</span> <span class="dv">2</span>,
  <span class="dt">end_pause =</span> <span class="dv">2</span>
)
<span class="kw">anim_save</span>(<span class="st">&#39;frog_slower.gif&#39;</span>, states_gif2)
<span class="kw">include_graphics</span>(<span class="st">&#39;frog_slower.gif&#39;</span>)</code></pre></div>
<p><img src="frog_slower.gif" style="display: block; margin: auto;" /></p>
<p>If your sole purpose is to display, then saving the image file and using <code>include_graphics()</code> is unnecessary. For that purpose, you can just use <code>animate()</code>.</p>
</div>
<div id="session-info" class="section level1">
<h1>Session info</h1>
<p>R session info:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sessionInfo</span>()</code></pre></div>
<pre><code>## R version 3.6.0 (2019-04-26)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 10 x64 (build 17763)
## 
## Matrix products: default
## 
## locale:
## [1] LC_COLLATE=English_Canada.1252  LC_CTYPE=English_Canada.1252   
## [3] LC_MONETARY=English_Canada.1252 LC_NUMERIC=C                   
## [5] LC_TIME=English_Canada.1252    
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] tidyr_0.8.3     gganimate_1.0.3 ggplot2_3.1.1   dplyr_0.8.1    
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.1        pillar_1.4.0      compiler_3.6.0   
##  [4] plyr_1.8.4        prettyunits_1.0.2 prettydoc_0.2.1  
##  [7] tools_3.6.0       progress_1.2.2    digest_0.6.18    
## [10] evaluate_0.13     tibble_2.1.1      gtable_0.3.0     
## [13] pkgconfig_2.0.2   rlang_0.3.4       yaml_2.2.0       
## [16] xfun_0.7          withr_2.1.2       stringr_1.4.0    
## [19] knitr_1.23        hms_0.4.2         grid_3.6.0       
## [22] tidyselect_0.2.5  glue_1.3.1        R6_2.4.0         
## [25] rmarkdown_1.12    purrr_0.3.2       tweenr_1.0.1     
## [28] farver_1.1.0      magrittr_1.5      scales_1.0.0     
## [31] htmltools_0.3.6   assertthat_0.2.1  colorspace_1.4-1 
## [34] stringi_1.4.3     lazyeval_0.2.2    munsell_0.5.0    
## [37] crayon_1.3.4</code></pre>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Rosenthal, J. (2019, April 05). STA447/2006 (Stochastic Processes) Lecture Notes, Winter 2019. Retrieved May 21, 2019, from <a href="http://probability.ca/jeff/teaching/1819/sta447/notes.pdf" class="uri">http://probability.ca/jeff/teaching/1819/sta447/notes.pdf</a><a href="#fnref1">↩</a></p></li>
</ol>
</div>
</section>

&nbsp;
<!-- Reference: https://holtzy.github.io/Pimp-my-rmd/ -->

<hr />
<p style="text-align: center;">written by <a href="https://github.com/joon3216">Junkyu Park</a></p>
<p style="text-align: center;"><span style="color: #555555;"><em>joon3216@gmail.com</em></span></p>

<!-- Add icon library -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<!-- Add font awesome icons -->
<p style="text-align: center;">
    <a href="https://www.facebook.com/asdfzxcvjkl1" class="fa fa-facebook"></a>
    <a href="https://github.com/joon3216" class="fa fa-github"></a>
    <a href="https://linkedin.com/in/asdfzxcvjkl1/" class="fa fa-linkedin"></a>
</p>

&nbsp;


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
