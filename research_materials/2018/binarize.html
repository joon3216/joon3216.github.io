<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Junkyu Park" />


<title>Binarizing data using data.table</title>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-139050237-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-139050237-1');
</script>
<!-- A new navigation bar style settings -->
<style type="text/css">
/* at the top */
#navbar
{
    position: sticky;
    z-index: 1000; /* new; why: make navbar closest to the observer */
    top: 0;
    left: 0;
    padding: 0; /* old: 10px 25px */
    background: rgba(28, 44, 56, 0.99);
    width: 100%;
    height: 50px;
    box-sizing: border-box;
    border-bottom: 1px solid #EAEAEB;
    transition: .5s;
}
#navbar .logo
{
    float: left;
}
#navbar .logo img
{
    height: 30px;
    /* new: margin; why: so that in header, padding can be 0 */
    /* note: header nav ul li a has margin 20px on left and right, 
    so here I let the right margin of img to be 5px so that it matches
    with the left margin 25px */
    /* edit: 5 to 20px since it looks nicer */
    margin: 10px 20px 10px 25px; 
}
#navbar nav
{
    float: right; /* old: left; why change: to give a more standard look */
    margin: 0 27.5px 0 0;
}
#navbar nav ul
{
    margin: 0;
    padding: 0;
    display: flex;

}
#navbar nav ul li
{
    padding: 0;
    list-style: none;
    position: relative;
    /* new: margin and padding; why: header padding is now 0 */
    margin: 0;
    padding: 8.5px 0 8.5px 0;
}
/* new; why: texts with arrow on the right gets more space  */
#navbar nav ul li.sub-menu
{
    /* why 8.5px: that's the value in header nav ul li padding */
    padding: 8.5px 27.5px 8.5px 0;
    padding-bottom: 12px;
    /* new; why: to make dropdown menu available once the mouse is on the menu item that it belongs, and to not affect other menu items that is not of class sub-menu */
}

/* new; why: prepare in case of text-align: right */
#navbar nav ul li#news
{
    padding: 8.5px 0;
    margin: 0;
}

/* new; why: this potentially has a different background color */
#navbar nav ul li#home
{
    background-color: rgba(21, 92, 148, .9); /* old: rgba(28, 44, 56, 0); */
    border-bottom: 1px solid #EAEAEB;
    margin: 0 0 .5px 0;
}

#navbar nav ul li.sub-menu:before
{
    content: '\f0d7'; /* &#9660 ▼ nabla */
    font-family: fontAwesome; /* old: sans-serif */
    font-size: 16pt;
    position: absolute;
    /*line-height: 30px;*/
    color: #ffffff;
    top: 7pt;
    right: 22.5px;
    cursor: pointer;
}
#navbar nav ul li.active.sub-menu:before
{
    content: '\f0d8';  /* &#9650 ▲ Delta */
    font-family: fontAwesome; /* new */
    font-size: 16pt;
    position: absolute;
    color: #666;
    top: 7pt;
    right: 22.5px;
    cursor: pointer;
}
#navbar nav ul li ul
{
    position: absolute;
    left: 0;
    top: 50px; /* controls the box position of dropdown menus */
    background: rgba(57, 143, 209, 0.99);
    display: none;
}
#navbar nav ul li.active ul
{
    display: block;
}

/* new; why: make dropdown menu box fit to the menu above */
/* padding: 0; is for slimmer individual dropdown menu items */
/* old */
#navbar nav ul li.sub-menu ul li
{
    display: block;
    width: 200px;
    padding: 5px 0;
}

/* new: header nav ul li ul li a */
/* why: giving an indentation */
#navbar nav ul li ul li a
{
    margin: 0 40px;
}

/* header nav ul li#projects.sub-menu ul li
{
    display: block;
    width: 115px;
    padding: 0;
}
header nav ul li#rm.sub-menu ul li
{
    display: block;
    width: 197px;
    padding: 0;
} */

#navbar nav ul li a
{
    height: 30px;
    line-height: 30px;
    padding: 0; /* old: 0 20px, and margin didn't exist; why change: to make text the only clickable object */
    margin: 0 20px;
    color: #ffffff;
    text-decoration: none;
    text-shadow: none; /* new; why: to be compatible with the Tactile theme */
    /*display: block;*/
}

/* new: news; why add: to make News go to the right */
/* commented out because the same effect is achieved by having 
header nav ul li.sub-menu padding: 8.5px 15px 8.5px 0; */
/* header nav ul li.news
{
    margin: 0 0 0 20px;
} */

/* new: rm; why: to make r_m go to the right */
/* commented out because the same effect is achieved by having 
header nav ul li.sub-menu padding: 8.5px 15px 8.5px 0; */
/* header nav ul li#rm
{
    margin: 0 0 0 20px;
} */


#navbar nav ul li a:hover
{
    color: #666;
}

/* new: header nav ul li:hover ul, why: to make dropdown menu appear whenever mouse is above */
#navbar nav ul li:hover ul
{
    display: block;
}

#navbar nav ul li:hover ul li:hover
{
    background-color: rgba(5, 83, 143, 0.99);
}

.menu-toggle
{
    color: #ffffff;
    float: right;
    line-height: 30px;
    font-size: 24px;
    cursor: pointer;
    display: none;
    text-shadow: none;
}
@media (max-width: 800px) /* old1: 991px; old2: 721px */
{
    /* at the top */
    #navbar
    {
        padding: 0; /* old: 10px 25px */
    }
    .menu-toggle
    {
        display: block;
        margin: 10px 25px /* new; why: header padding is now 0 */
    }
    #navbar nav
    {
        /*display: none;*/
        overflow: auto; /* new; why: when mobile, make sure scroll shows up if vertical space not sufficient to display every element of nav */
        position: absolute;
        width: 100%;
        height: calc(100vh - 50px);
        background: rgba(28, 44, 56, 0.99);
        top: 50px;
        left: -100%;
        transition: .5s;
    }
    #navbar nav.active
    {
        left: 0;
    }
    #navbar nav ul
    {
        display: block;
        /*text-align: center;*/
    }

    /* new; why: to make sure it doesn't appear in mobile view;
    I don't want to see it in mobile since the logo already directs you
    to home. Adding home in mobile seems a clutter.
    */
    #navbar nav ul li#home
    {
        display: none;
    }

    #navbar nav ul li a
    {
        border-bottom: 1px solid rgba(255, 255, 255, .5);
        height: 50px;
        line-height: 50px;
        padding: 0 20px;
    }
    #navbar nav ul li.active ul
    {
        position: relative;
    }
    #navbar nav ul li ul li
    {
        width: 100%;
    }

    /* new: header nav ul li.sub-menu */
    /* why: so that dropdown menus fill the entire row in mobile */
    #navbar nav ul li.sub-menu
    {
        padding: 8.5px 0;
    }

    #navbar nav ul li.sub-menu:before
    {
        content: '+'; /* old: &#9660 nabla */
        font-size: 20pt;
        font-family: sans-serif;
        height: 40px;
        position: absolute;
        /* line-height: 30px; */
        color: #ffffff;
        width: 20px;
        /* top: 5pt; */
        right: 25px;
        cursor: pointer;
        bottom: 18px;
    }
    #navbar nav ul li.active.sub-menu:before
    {
        content: '–';  /* new: &#9650 Delta */
        font-size: 20pt;
        /* top: 5pt; */
        right: 25px;
        /* line-height: 30px; */
        cursor: pointer;
        position: absolute;
        color: #666;
        bottom: 18px;
        height: 40px;
    }
    #navbar nav ul li ul
    {
        position: absolute;
        left: 0;
        top: 0px; /* controls the box position of 2018 and 2019 under Research materials */
        background: rgba(57, 143, 209, 0.99);
        display: none;
    }

    /* new: hover and active
    why: do not display drop down menus when mouse is over it in mobile, 
    but display them when plus signs are clicked */
    #navbar nav ul li:hover ul
    {
        display: none;
    }
    #navbar nav ul li.active ul
    {
        display: block;
    }

    /* new; why: no background color change in dropdown menu when hovering over in mobile */
    #navbar nav ul li.sub-menu:hover ul li:hover
    {
        background-color: rgba(5, 83, 143, 0);
    }

    /* new: News; why: to make News align with the others in mobile */
    /* commented out since Research Materials uses different method
    to get more space on its right (header nav ul li.sub-menu padding) */

    /* header nav ul li.news
    {
        margin: 0;
    } */
    /* new: rm; why: to make rm align with the others in mobile */
    /* commented out for the same reason */
    /* header nav ul li#rm
    {
        margin: 0;
    } */

    /* while scrolling */
    #navbar.black nav ul li a:hover
    {
        color: #666;
    }
}

/* while scrolling */
#navbar.black
{
    background: rgba(21, 92, 148, .9);
}
#navbar.black nav ul li#home
{
    background-color: rgba(28, 44, 56, 0);
    /* border-bottom: 1px solid #EAEAEB;
    margin: 0 0 .5px 0; why commented: unnecessary */
    transition: .2s;
}
#navbar.black nav ul li a:hover
{
    color: darkgrey;
}
#navbar.black nav ul li.active.sub-menu:before
{
    color: darkgrey;
}
</style>

<!-- 1. Navigation bar color change as one scrolls -->
<!-- by adding a new class="black" while scrolling -->
<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
<script type="text/javascript">
    $(window).on('scroll', function(){
        if ($(window).scrollTop()){
           navbar.classList.add('black');
           /* old: $('header').addClass('black'); */
        }
        else
        {
            navbar.classList.remove('black');
            /* old: $('header').removeClass('black'); */
        }
    })
</script>

<!-- 2. Navigation bar slides from the left in mobile -->
<!-- 3. Only one dropdown menu at a time will appear -->
<script type="text/javascript">
    $(document).ready(function(){
        $('.menu-toggle').click(function(){
            $('nav').toggleClass('active')
        })
        $('ul li').click(function(){
            $(this).siblings().removeClass('active');
            $(this).toggleClass('active');
        })
    })
</script>

<!-- Using caret down and up symbols -->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
<link rel="icon" href="../../style/all_orange_jp.png">


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link rel="stylesheet" href="binarize_files/style.css" type="text/css" />

</head>

<body>


<!-- A new navigation bar -->
<div id="navbar">
    <div class="logo">
        <a href="../../index.html"><img src="../../style/all_orange_jp.png"></a>
    </div>
    <nav>
        <ul>
            <li id="home">
                <a href="../../index.html">Home</a>
            </li>
            <li class="sub-menu" id="projects">
                <a href="../../projects.html">Projects</a>
                <ul>
                    <li>
                        <a href="../../projects/2019.html">2019</a>
                    </li>
                </ul>
            </li>
            <li class="sub-menu" id="rm">
                <a href="../../research_materials.html">Research materials</a>
                <ul>
                    <li>
                        <a href="../../research_materials/2018.html">2018</a>
                    </li>
                    <li>
                        <a href="../../research_materials/2019.html">2019</a>
                    </li>
                </ul>
            </li>
            <li id="news">
                <a href="../../news.html">News</a>
            </li>
            <li>
                <a href="../../files/cv_junkyu_park.pdf">CV</a>
            </li>
        </ul>
    </nav>
    <div class="menu-toggle">
        <i class="fa fa-bars" aria-hidden="true"></i>
    </div>
</div>


<section class="page-header">
<h1 class="title toc-ignore project-name">Binarizing data using data.table</h1>
<h4 class="author project-author">Junkyu Park</h4>
</section>



<section class="main-content">
<p>The following packages and datasets are used:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(boot)
<span class="kw">library</span>(data.table)
<span class="co"># devtools::install_github(&#39;joon3216/funpark&#39;)</span>
<span class="kw">library</span>(funpark)
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(ggrepel)
<span class="kw">library</span>(pROC)
as_tibble &lt;-<span class="st"> </span>dplyr<span class="op">::</span>as_tibble
<span class="kw">data</span>(femsmoke, <span class="dt">package =</span> <span class="st">&#39;faraway&#39;</span>)
<span class="kw">data</span>(nodal, <span class="dt">package =</span> <span class="st">&#39;SMPracticals&#39;</span>)</code></pre></div>

<div id="TOC" class="toc" style="padding:2rem 2rem 0 0;">
<ul style="list-style:none;">
<li><a href="#introduction">1. Introduction</a></li>
<li><a href="#case-studies">2. Case studies</a><ul>
<li><a href="#case-1-nodal">Case 1: <code>nodal</code></a></li>
<li><a href="#case-2-femsmoke">Case 2: <code>femsmoke</code></a></li>
</ul></li>
<li><a href="#applications">3. Applications</a><ul>
<li><a href="#roc-curve">ROC curve</a></li>
<li><a href="#confidence-interval-for-auc">Confidence interval for AUC</a></li>
</ul></li>
<li><a href="#aside-change_form">4. Another application: <code>change_form</code></a></li>
<li><a href="#session-info">Session info</a></li>
<li><a href="#related-pages">Related pages</a></li>
</ul>
</div>
&nbsp;

<div id="introduction" class="section level1">
<h1>1. Introduction</h1>
<p>In order to fit a model using logistic regression, we require a binary response. However, if we are given categorical features, such as age group, then data can be structured so that responses are not binary, but rather a count of cases for each combination of features. As an example, consider <code>rich</code> dataset where:</p>
<ul>
<li><code>is_rich</code> is a response variable having 1 if the person is rich and 0 otherwise</li>
<li><code>gender</code> is a categorical variable with two categories: <code>M</code> or <code>F</code></li>
<li><code>criminal_record</code> is also a categorical variable: <code>yes</code> if the person has one, and <code>no</code> otherwise</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1024</span>)
is_rich &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dv">10</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> .<span class="dv">5</span>)
gender &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dv">10</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> .<span class="dv">5</span>)
criminal_record &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dv">10</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> .<span class="dv">5</span>)

<span class="co"># Binary response</span>
(rich &lt;-<span class="st"> </span><span class="kw">data.table</span>(
    <span class="dt">gender =</span> <span class="kw">ifelse</span>(gender <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&#39;M&#39;</span>, <span class="st">&#39;F&#39;</span>),
    <span class="dt">criminal_record =</span> <span class="kw">ifelse</span>(criminal_record <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&#39;yes&#39;</span>, <span class="st">&#39;no&#39;</span>),
    <span class="dt">is_rich =</span> is_rich
))</code></pre></div>
<pre><code>##     gender criminal_record is_rich
##  1:      F              no       0
##  2:      M              no       1
##  3:      F              no       0
##  4:      F              no       0
##  5:      M             yes       0
##  6:      F             yes       1
##  7:      M             yes       0
##  8:      M              no       0
##  9:      M              no       1
## 10:      F             yes       1</code></pre>
<p>This <code>rich</code> dataset has a binary response. However, when you are given a dataset for the first time, it may have a following form:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Binomial response</span>
(rich_binom &lt;-<span class="st"> </span>rich[
    <span class="kw">order</span>(gender, criminal_record), 
    .(<span class="dt">rich =</span> <span class="kw">sum</span>(is_rich), <span class="dt">not_rich =</span> <span class="kw">sum</span>(<span class="op">!</span>is_rich)), 
    <span class="dt">by =</span> <span class="st">&quot;gender,criminal_record&quot;</span>
])</code></pre></div>
<pre><code>##    gender criminal_record rich not_rich
## 1:      F              no    0        3
## 2:      F             yes    2        0
## 3:      M              no    2        1
## 4:      M             yes    0        2</code></pre>
<p>or:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Count; response variable is now &#39;count&#39;, not &#39;is_rich&#39;</span>
(rich_pois &lt;-<span class="st"> </span><span class="kw">melt</span>(
    rich_binom, 
    <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&#39;gender&#39;</span>, <span class="st">&#39;criminal_record&#39;</span>),
    <span class="dt">variable.name =</span> <span class="st">&#39;is_rich&#39;</span>,
    <span class="dt">value.name =</span> <span class="st">&#39;count&#39;</span>
))</code></pre></div>
<pre><code>##    gender criminal_record  is_rich count
## 1:      F              no     rich     0
## 2:      F             yes     rich     2
## 3:      M              no     rich     2
## 4:      M             yes     rich     0
## 5:      F              no not_rich     3
## 6:      F             yes not_rich     0
## 7:      M              no not_rich     1
## 8:      M             yes not_rich     2</code></pre>
<p>Forms of <code>rich_binom</code> and <code>rich_pois</code> allow us to fit binomial and poisson regression respectively, but not the logistic regression. This document is about transforming the second and third dataset into the first one, i.e. binarizing datasets.</p>
</div>
<div id="case-studies" class="section level1">
<h1>2. Case studies</h1>
<p>The first case concern with transformation from a binomial response to a binary response, and the second case is from a count response to a binary response.</p>
<div id="case-1-nodal" class="section level2">
<h2>Case 1: <code>nodal</code></h2>
<p><code>nodal</code> is the dataset in <code>SMPracticals</code> package where:</p>
<ul>
<li><code>m</code> is just a column of ones</li>
<li><code>r</code> is an indicator of nodal involvement (<code>1</code> for yes, <code>0</code> for no)</li>
<li><code>aged</code>, <code>stage</code>, <code>grade</code>, <code>xray</code>, <code>acid</code> are categorical features</li>
</ul>
<p>See <a href="https://rdrr.io/cran/SMPracticals/man/nodal.html">here</a> for more information.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setDT</span>(nodal)
<span class="kw">as_tibble</span>(nodal)</code></pre></div>
<pre><code>## # A tibble: 53 x 7
##        m     r aged  stage grade xray  acid 
##    &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;
##  1     1     1 0     1     1     1     1    
##  2     1     1 0     1     1     1     1    
##  3     1     1 0     1     1     1     1    
##  4     1     1 0     1     1     1     1    
##  5     1     1 0     1     1     1     1    
##  6     1     0 0     1     1     1     1    
##  7     1     1 0     0     0     0     1    
##  8     1     0 0     0     0     0     1    
##  9     1     0 0     0     0     0     1    
## 10     1     0 0     0     0     0     1    
## # ... with 43 more rows</code></pre>
<p>We can transform this into <code>nodal_binom</code>, the data that has binomial responses:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nodal_binom &lt;-<span class="st"> </span>nodal[
    , 
    .(<span class="dt">m =</span> <span class="kw">sum</span>(m), <span class="dt">r =</span> <span class="kw">sum</span>(r)), 
    by =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;aged&#39;</span>, <span class="st">&#39;stage&#39;</span>, <span class="st">&#39;grade&#39;</span>, <span class="st">&#39;xray&#39;</span>, <span class="st">&#39;acid&#39;</span>)
][
    , 
    <span class="kw">c</span>(<span class="st">&#39;yes_node&#39;</span>, <span class="st">&#39;no_node&#39;</span>, <span class="st">&#39;m&#39;</span>, <span class="st">&#39;r&#39;</span>) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">list</span>(r, m <span class="op">-</span><span class="st"> </span>r, <span class="ot">NULL</span>, <span class="ot">NULL</span>)
][
    <span class="kw">order</span>(<span class="op">-</span>yes_node, <span class="op">-</span>no_node)
][]
<span class="kw">as_tibble</span>(nodal_binom)</code></pre></div>
<pre><code>## # A tibble: 23 x 7
##    aged  stage grade xray  acid  yes_node no_node
##    &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;    &lt;dbl&gt;   &lt;dbl&gt;
##  1 0     1     1     1     1            5       1
##  2 1     1     0     0     1            2       2
##  3 0     1     1     0     1            2       1
##  4 0     0     0     0     1            1       5
##  5 1     1     0     0     0            1       2
##  6 0     1     0     0     1            1       1
##  7 0     0     1     0     0            1       1
##  8 1     1     1     1     1            1       0
##  9 1     1     0     1     1            1       0
## 10 1     0     1     1     1            1       0
## # ... with 13 more rows</code></pre>
<p><code>nodal_binom</code> has a form of <code>rich_binom</code>, where the last two columns are computed from <code>r</code>, the binary response in the original <code>nodal</code> data. <code>yes_node</code> is a count of 1’s in <code>r</code> in the original dataset, and <code>no_node</code> a count of 0’s.</p>
<p>The function <code>binarize_binom</code> will convert <code>nodal_binom</code> back to <code>nodal</code>. <code>dpmf</code> and <code>rpmf</code> (in <code>funpark</code> package) are used to create random names for variable and value columns in order to avoid duplicate names:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">binarize_binom &lt;-<span class="st"> </span><span class="cf">function</span>(dat, responses, <span class="dt">variable.name =</span> <span class="ot">NULL</span>) {
    <span class="co"># dat: a data whose features are categorical</span>
    <span class="co"># responses: a character vector of length 2; each element is the name of</span>
    <span class="co">#            column that stores the counts of positive and negative</span>
    <span class="co">#            responses, in this order.</span>
    <span class="co"># variable.name: a character; if NULL, then a randomly generated </span>
    <span class="co">#                character will be used.</span>
    
    <span class="co"># Generate random names to avoid the same names as in features</span>
    all_alphabets &lt;-<span class="st"> </span><span class="kw">c</span>(
        <span class="st">&#39;A&#39;</span>, <span class="st">&#39;a&#39;</span>, <span class="st">&#39;B&#39;</span>, <span class="st">&#39;b&#39;</span>, <span class="st">&#39;C&#39;</span>, <span class="st">&#39;c&#39;</span>, <span class="st">&#39;D&#39;</span>, <span class="st">&#39;d&#39;</span>, <span class="st">&#39;E&#39;</span>, <span class="st">&#39;e&#39;</span>, <span class="st">&#39;F&#39;</span>, <span class="st">&#39;f&#39;</span>,
        <span class="st">&#39;G&#39;</span>, <span class="st">&#39;g&#39;</span>, <span class="st">&#39;H&#39;</span>, <span class="st">&#39;h&#39;</span>, <span class="st">&#39;I&#39;</span>, <span class="st">&#39;i&#39;</span>, <span class="st">&#39;J&#39;</span>, <span class="st">&#39;j&#39;</span>, <span class="st">&#39;K&#39;</span>, <span class="st">&#39;k&#39;</span>, <span class="st">&#39;L&#39;</span>, <span class="st">&#39;l&#39;</span>,
        <span class="st">&#39;M&#39;</span>, <span class="st">&#39;m&#39;</span>, <span class="st">&#39;N&#39;</span>, <span class="st">&#39;n&#39;</span>, <span class="st">&#39;O&#39;</span>, <span class="st">&#39;o&#39;</span>, <span class="st">&#39;P&#39;</span>, <span class="st">&#39;p&#39;</span>, <span class="st">&#39;Q&#39;</span>, <span class="st">&#39;q&#39;</span>, <span class="st">&#39;R&#39;</span>, <span class="st">&#39;r&#39;</span>,
        <span class="st">&#39;S&#39;</span>, <span class="st">&#39;s&#39;</span>, <span class="st">&#39;T&#39;</span>, <span class="st">&#39;t&#39;</span>, <span class="st">&#39;U&#39;</span>, <span class="st">&#39;u&#39;</span>, <span class="st">&#39;V&#39;</span>, <span class="st">&#39;v&#39;</span>, <span class="st">&#39;W&#39;</span>, <span class="st">&#39;w&#39;</span>, <span class="st">&#39;X&#39;</span>, <span class="st">&#39;x&#39;</span>,
        <span class="st">&#39;Y&#39;</span>, <span class="st">&#39;y&#39;</span>, <span class="st">&#39;Z&#39;</span>, <span class="st">&#39;z&#39;</span>
    )
    dalphabet &lt;-<span class="st"> </span><span class="cf">function</span>(x){
        <span class="kw">dpmf</span>(
            x, 
            <span class="kw">rep</span>(<span class="dv">1</span>, <span class="kw">length</span>(all_alphabets)) <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(all_alphabets),
            all_alphabets
        )
    }
    separator &lt;-<span class="st"> </span>
<span class="st">        </span><span class="kw">paste0</span>(<span class="kw">rpmf</span>(<span class="dv">10</span>, dalphabet, all_alphabets), <span class="dt">collapse =</span> <span class="st">&#39;&#39;</span>)
    united &lt;-<span class="st"> </span>
<span class="st">        </span><span class="kw">paste0</span>(<span class="kw">rpmf</span>(<span class="dv">10</span>, dalphabet, all_alphabets), <span class="dt">collapse =</span> <span class="st">&#39;&#39;</span>)
    
    <span class="co"># Setup</span>
    col_names &lt;-<span class="st"> </span><span class="kw">colnames</span>(dat)
    id_vars &lt;-<span class="st"> </span>col_names[<span class="op">!</span>(col_names <span class="op">%in%</span><span class="st"> </span>responses)]
    <span class="cf">if</span> (<span class="op">!</span>(<span class="st">&#39;data.table&#39;</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">class</span>(dat))) {<span class="kw">setDT</span>(dat)}
    <span class="cf">if</span> (<span class="kw">is.null</span>(variable.name)) {
        variable_name &lt;-<span class="st"> </span>
<span class="st">            </span><span class="kw">paste0</span>(<span class="kw">rpmf</span>(<span class="dv">10</span>, dalphabet, all_alphabets), <span class="dt">collapse =</span> <span class="st">&#39;&#39;</span>)
        <span class="kw">message</span>(<span class="st">&#39;Randomly generated variable name used: &#39;</span>, variable_name)
    } <span class="cf">else</span> {
        variable_name &lt;-<span class="st"> </span>variable.name
    }
    value_name &lt;-<span class="st"> </span>
<span class="st">        </span><span class="kw">paste0</span>(<span class="kw">rpmf</span>(<span class="dv">10</span>, dalphabet, all_alphabets), <span class="dt">collapse =</span> <span class="st">&#39;&#39;</span>)

    <span class="co"># Transform into the form that is used in poisson regression</span>
    dat &lt;-<span class="st"> </span><span class="kw">melt</span>(
        dat,
        <span class="dt">id.vars =</span> id_vars,
        <span class="dt">variable.name =</span> variable_name,
        <span class="dt">value.name =</span> value_name
    )
    id_vars &lt;-<span class="st"> </span><span class="kw">c</span>(id_vars, variable_name)
    
    <span class="co"># Binarize</span>
    dat &lt;-<span class="st"> </span><span class="kw">eval</span>(<span class="kw">parse</span>(<span class="dt">text =</span> <span class="kw">paste0</span>(
        <span class="st">&#39;dat[&#39;</span>, value_name, <span class="st">&#39; != 0, &#39;</span>,
        <span class="st">&#39;.(&#39;</span>, united, <span class="st">&#39; = do.call(paste, c(.SD, sep = </span><span class="ch">\&quot;</span><span class="st">&#39;</span>, separator, 
        <span class="st">&#39;</span><span class="ch">\&quot;</span><span class="st">)), &#39;</span>, value_name, <span class="st">&#39;), .SDcols = id_vars]&#39;</span>
    )))
    dat &lt;-<span class="st"> </span>dat[
        ,
        <span class="kw">list</span>(
            <span class="dt">result =</span> <span class="kw">rep</span>(
                <span class="kw">as.data.frame</span>(dat)[, united],
                <span class="kw">as.data.frame</span>(dat)[, value_name]
            )
        )
    ][
        , <span class="co"># requires data.table ver &gt;= 1.9.6 because of tstrsplit</span>
        <span class="kw">c</span>(id_vars) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">tstrsplit</span>(result, separator, <span class="dt">fixed =</span> T)
    ][
        , 
        <span class="kw">c</span>(id_vars), 
        with =<span class="st"> </span>F
    ]
    dat
}</code></pre></div>
<p>Let’s see if it works on <code>rich_binom</code> data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rich <span class="co"># original binary data</span></code></pre></div>
<pre><code>##     gender criminal_record is_rich
##  1:      F              no       0
##  2:      M              no       1
##  3:      F              no       0
##  4:      F              no       0
##  5:      M             yes       0
##  6:      F             yes       1
##  7:      M             yes       0
##  8:      M              no       0
##  9:      M              no       1
## 10:      F             yes       1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rich_binom <span class="co"># transformed into binomial response</span></code></pre></div>
<pre><code>##    gender criminal_record rich not_rich
## 1:      F              no    0        3
## 2:      F             yes    2        0
## 3:      M              no    2        1
## 4:      M             yes    0        2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># binarized</span>
(rich_binary &lt;-<span class="st"> </span><span class="kw">binarize_binom</span>(
    <span class="dt">dat =</span> rich_binom, 
    <span class="dt">responses =</span> <span class="kw">c</span>(<span class="st">&#39;rich&#39;</span>, <span class="st">&#39;not_rich&#39;</span>), 
    <span class="dt">variable.name =</span> <span class="st">&#39;is_rich&#39;</span>
))</code></pre></div>
<pre><code>##     gender criminal_record  is_rich
##  1:      F             yes     rich
##  2:      F             yes     rich
##  3:      M              no     rich
##  4:      M              no     rich
##  5:      F              no not_rich
##  6:      F              no not_rich
##  7:      F              no not_rich
##  8:      M              no not_rich
##  9:      M             yes not_rich
## 10:      M             yes not_rich</code></pre>
<p>Are <code>rich</code> and <code>rich_binary</code> equivalent?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rich_binary[, is_rich <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">ifelse</span>(is_rich <span class="op">==</span><span class="st"> &#39;rich&#39;</span>, 1L, 0L)]
<span class="kw">setequal</span>(rich[<span class="kw">order</span>(<span class="op">-</span>is_rich, gender, criminal_record)], rich_binary)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Yes, they are. Likewise, the binarized <code>nodal_binom</code> is the same as the original <code>nodal</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as_tibble</span>(nodal_binom) <span class="co"># binomial response</span></code></pre></div>
<pre><code>## # A tibble: 23 x 7
##    aged  stage grade xray  acid  yes_node no_node
##    &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;    &lt;dbl&gt;   &lt;dbl&gt;
##  1 0     1     1     1     1            5       1
##  2 1     1     0     0     1            2       2
##  3 0     1     1     0     1            2       1
##  4 0     0     0     0     1            1       5
##  5 1     1     0     0     0            1       2
##  6 0     1     0     0     1            1       1
##  7 0     0     1     0     0            1       1
##  8 1     1     1     1     1            1       0
##  9 1     1     0     1     1            1       0
## 10 1     0     1     1     1            1       0
## # ... with 13 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># variable.name not specified</span>
<span class="kw">as_tibble</span>(<span class="kw">binarize_binom</span>(nodal_binom, <span class="kw">c</span>(<span class="st">&#39;yes_node&#39;</span>, <span class="st">&#39;no_node&#39;</span>))) </code></pre></div>
<pre><code>## Randomly generated variable name used: LEXhgicUWS</code></pre>
<pre><code>## # A tibble: 53 x 6
##    aged  stage grade xray  acid  LEXhgicUWS
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;     
##  1 0     1     1     1     1     yes_node  
##  2 0     1     1     1     1     yes_node  
##  3 0     1     1     1     1     yes_node  
##  4 0     1     1     1     1     yes_node  
##  5 0     1     1     1     1     yes_node  
##  6 1     1     0     0     1     yes_node  
##  7 1     1     0     0     1     yes_node  
##  8 0     1     1     0     1     yes_node  
##  9 0     1     1     0     1     yes_node  
## 10 0     0     0     0     1     yes_node  
## # ... with 43 more rows</code></pre>
<p>Note that categorical variables are changed from factors into character vectors.</p>
</div>
<div id="case-2-femsmoke" class="section level2">
<h2>Case 2: <code>femsmoke</code></h2>
<p><code>femsmoke</code> data in <code>faraway</code> package has the following columns:</p>
<ul>
<li><code>y</code>: observed count for given combination</li>
<li><code>smoker</code>, <code>dead</code>, <code>age</code>: categorical features</li>
</ul>
<p>See <a href="https://www.rdocumentation.org/packages/faraway/versions/1.0.7/topics/femsmoke">here</a> for details:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">femsmoke</code></pre></div>
<pre><code>##      y smoker dead   age
## 1    2    yes  yes 18-24
## 2    1     no  yes 18-24
## 3    3    yes  yes 25-34
## 4    5     no  yes 25-34
## 5   14    yes  yes 35-44
## 6    7     no  yes 35-44
## 7   27    yes  yes 45-54
## 8   12     no  yes 45-54
## 9   51    yes  yes 55-64
## 10  40     no  yes 55-64
## 11  29    yes  yes 65-74
## 12 101     no  yes 65-74
## 13  13    yes  yes   75+
## 14  64     no  yes   75+
## 15  53    yes   no 18-24
## 16  61     no   no 18-24
## 17 121    yes   no 25-34
## 18 152     no   no 25-34
## 19  95    yes   no 35-44
## 20 114     no   no 35-44
## 21 103    yes   no 45-54
## 22  66     no   no 45-54
## 23  64    yes   no 55-64
## 24  81     no   no 55-64
## 25   7    yes   no 65-74
## 26  28     no   no 65-74
## 27   0    yes   no   75+
## 28   0     no   no   75+</code></pre>
<p>The task is to populate each (<code>smoker</code>, <code>dead</code>, <code>age</code>) combination according to the counts in <code>y</code>. For example, in the new binarized dataset, there will be two rows of (<code>smoker = yes</code>, <code>dead = yes</code>, <code>age = 18-24</code>), 64 rows of (<code>smoker = no</code>, <code>dead = yes</code>, <code>age = 75+</code>), and so on.</p>
<p><code>binarize_pois</code> is designed to handle datasets designed for poisson regression:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">binarize_pois &lt;-<span class="st"> </span><span class="cf">function</span>(dat, response) {
    <span class="co"># dat: a data whose features are categorical</span>
    <span class="co"># response: a character; the name of column that stores the counts</span>
    
    <span class="co"># Generate random names to avoid the same names as in features</span>
    all_alphabets &lt;-<span class="st"> </span><span class="kw">c</span>(
        <span class="st">&#39;A&#39;</span>, <span class="st">&#39;a&#39;</span>, <span class="st">&#39;B&#39;</span>, <span class="st">&#39;b&#39;</span>, <span class="st">&#39;C&#39;</span>, <span class="st">&#39;c&#39;</span>, <span class="st">&#39;D&#39;</span>, <span class="st">&#39;d&#39;</span>, <span class="st">&#39;E&#39;</span>, <span class="st">&#39;e&#39;</span>, <span class="st">&#39;F&#39;</span>, <span class="st">&#39;f&#39;</span>,
        <span class="st">&#39;G&#39;</span>, <span class="st">&#39;g&#39;</span>, <span class="st">&#39;H&#39;</span>, <span class="st">&#39;h&#39;</span>, <span class="st">&#39;I&#39;</span>, <span class="st">&#39;i&#39;</span>, <span class="st">&#39;J&#39;</span>, <span class="st">&#39;j&#39;</span>, <span class="st">&#39;K&#39;</span>, <span class="st">&#39;k&#39;</span>, <span class="st">&#39;L&#39;</span>, <span class="st">&#39;l&#39;</span>,
        <span class="st">&#39;M&#39;</span>, <span class="st">&#39;m&#39;</span>, <span class="st">&#39;N&#39;</span>, <span class="st">&#39;n&#39;</span>, <span class="st">&#39;O&#39;</span>, <span class="st">&#39;o&#39;</span>, <span class="st">&#39;P&#39;</span>, <span class="st">&#39;p&#39;</span>, <span class="st">&#39;Q&#39;</span>, <span class="st">&#39;q&#39;</span>, <span class="st">&#39;R&#39;</span>, <span class="st">&#39;r&#39;</span>,
        <span class="st">&#39;S&#39;</span>, <span class="st">&#39;s&#39;</span>, <span class="st">&#39;T&#39;</span>, <span class="st">&#39;t&#39;</span>, <span class="st">&#39;U&#39;</span>, <span class="st">&#39;u&#39;</span>, <span class="st">&#39;V&#39;</span>, <span class="st">&#39;v&#39;</span>, <span class="st">&#39;W&#39;</span>, <span class="st">&#39;w&#39;</span>, <span class="st">&#39;X&#39;</span>, <span class="st">&#39;x&#39;</span>,
        <span class="st">&#39;Y&#39;</span>, <span class="st">&#39;y&#39;</span>, <span class="st">&#39;Z&#39;</span>, <span class="st">&#39;z&#39;</span>
    )
    dalphabet &lt;-<span class="st"> </span><span class="cf">function</span>(x){
        <span class="kw">dpmf</span>(
            x, 
            <span class="kw">rep</span>(<span class="dv">1</span>, <span class="kw">length</span>(all_alphabets)) <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(all_alphabets),
            all_alphabets
        )
    }
    separator &lt;-<span class="st"> </span>
<span class="st">        </span><span class="kw">paste0</span>(<span class="kw">rpmf</span>(<span class="dv">10</span>, dalphabet, all_alphabets), <span class="dt">collapse =</span> <span class="st">&#39;&#39;</span>)
    united &lt;-<span class="st"> </span>
<span class="st">        </span><span class="kw">paste0</span>(<span class="kw">rpmf</span>(<span class="dv">10</span>, dalphabet, all_alphabets), <span class="dt">collapse =</span> <span class="st">&#39;&#39;</span>)
    
    <span class="co"># Setup</span>
    col_names &lt;-<span class="st"> </span><span class="kw">colnames</span>(dat)
    id_vars &lt;-<span class="st"> </span>col_names[<span class="op">!</span>(col_names <span class="op">%in%</span><span class="st"> </span>response)]
    <span class="cf">if</span> (<span class="op">!</span>(<span class="st">&#39;data.table&#39;</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">class</span>(dat))) {<span class="kw">setDT</span>(dat)}
    variable_name &lt;-<span class="st"> </span>
<span class="st">        </span><span class="kw">paste0</span>(<span class="kw">rpmf</span>(<span class="dv">10</span>, dalphabet, all_alphabets), <span class="dt">collapse =</span> <span class="st">&#39;&#39;</span>)
    value_name &lt;-<span class="st"> </span>
<span class="st">        </span><span class="kw">paste0</span>(<span class="kw">rpmf</span>(<span class="dv">10</span>, dalphabet, all_alphabets), <span class="dt">collapse =</span> <span class="st">&#39;&#39;</span>)
    
    <span class="co"># Binarize</span>
    dat &lt;-<span class="st"> </span><span class="kw">eval</span>(<span class="kw">parse</span>(<span class="dt">text =</span> <span class="kw">paste0</span>(
        <span class="st">&#39;dat[&#39;</span>, response, <span class="st">&#39; != 0, &#39;</span>,
        <span class="st">&#39;.(&#39;</span>, united, <span class="st">&#39; = do.call(paste, c(.SD, sep = </span><span class="ch">\&quot;</span><span class="st">&#39;</span>, separator, 
        <span class="st">&#39;</span><span class="ch">\&quot;</span><span class="st">)), &#39;</span>, response, <span class="st">&#39;), .SDcols = id_vars]&#39;</span>
    )))
    dat &lt;-<span class="st"> </span>dat[
        ,
        <span class="kw">list</span>(
            <span class="dt">result =</span> <span class="kw">rep</span>(
                <span class="kw">eval</span>(<span class="kw">parse</span>(<span class="dt">text =</span> <span class="kw">paste0</span>(<span class="st">&#39;dat$</span><span class="ch">\&quot;</span><span class="st">&#39;</span>, united, <span class="st">&#39;</span><span class="ch">\&quot;</span><span class="st">&#39;</span>))),
                <span class="kw">eval</span>(<span class="kw">parse</span>(<span class="dt">text =</span> <span class="kw">paste0</span>(<span class="st">&#39;dat$</span><span class="ch">\&quot;</span><span class="st">&#39;</span>, response, <span class="st">&#39;</span><span class="ch">\&quot;</span><span class="st">&#39;</span>)))
            )
        )
    ][
        , <span class="co"># requires data.table ver &gt;= 1.9.6 because of tstrsplit</span>
        <span class="kw">c</span>(id_vars) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">tstrsplit</span>(result, separator, <span class="dt">fixed =</span> T)
    ][
        , 
        <span class="kw">c</span>(id_vars), 
        with =<span class="st"> </span>F
    ]
    dat
}</code></pre></div>
<p>Now, recall <code>rich_pois</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rich_pois</code></pre></div>
<pre><code>##    gender criminal_record  is_rich count
## 1:      F              no     rich     0
## 2:      F             yes     rich     2
## 3:      M              no     rich     2
## 4:      M             yes     rich     0
## 5:      F              no not_rich     3
## 6:      F             yes not_rich     0
## 7:      M              no not_rich     1
## 8:      M             yes not_rich     2</code></pre>
<p>If we pass <code>rich_pois</code> into <code>binarize_pois</code>, we get:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(rich_binary2 &lt;-<span class="st"> </span><span class="kw">binarize_pois</span>(<span class="dt">dat =</span> rich_pois, <span class="dt">response =</span> <span class="st">&#39;count&#39;</span>))</code></pre></div>
<pre><code>##     gender criminal_record  is_rich
##  1:      F             yes     rich
##  2:      F             yes     rich
##  3:      M              no     rich
##  4:      M              no     rich
##  5:      F              no not_rich
##  6:      F              no not_rich
##  7:      F              no not_rich
##  8:      M              no not_rich
##  9:      M             yes not_rich
## 10:      M             yes not_rich</code></pre>
<p>Are <code>rich_binary</code> and <code>rich_binary2</code> equivalent?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rich_binary2[, is_rich <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">ifelse</span>(is_rich <span class="op">==</span><span class="st"> &#39;rich&#39;</span>, 1L, 0L)]
<span class="kw">setequal</span>(rich_binary, rich_binary2)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>We check that they are. We can apply <code>binarize_pois</code> to <code>femsmoke</code> as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(femsmoke_binary &lt;-<span class="st"> </span><span class="kw">binarize_pois</span>(femsmoke, <span class="st">&#39;y&#39;</span>))</code></pre></div>
<pre><code>##       smoker dead   age
##    1:    yes  yes 18-24
##    2:    yes  yes 18-24
##    3:     no  yes 18-24
##    4:    yes  yes 25-34
##    5:    yes  yes 25-34
##   ---                  
## 1310:     no   no 65-74
## 1311:     no   no 65-74
## 1312:     no   no 65-74
## 1313:     no   no 65-74
## 1314:     no   no 65-74</code></pre>
</div>
</div>
<div id="applications" class="section level1">
<h1>3. Applications</h1>
<div id="roc-curve" class="section level2">
<h2>ROC curve</h2>
<p>By having a binary response, we can draw a ROC curve using <code>roc_curve</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">roc_curve &lt;-<span class="st"> </span><span class="cf">function</span>(fmlr, dat) {
    <span class="co"># fmlr: a formula</span>
    <span class="co"># dat: a data with categorical features</span>
    
    mod &lt;-<span class="st"> </span><span class="kw">glm</span>(<span class="dt">formula =</span> fmlr, <span class="dt">family =</span> binomial, <span class="dt">data =</span> dat)
    ests &lt;-<span class="st"> </span><span class="kw">predict</span>(mod, <span class="dt">type =</span> <span class="st">&#39;response&#39;</span>)
    response &lt;-<span class="st"> </span><span class="kw">as.character</span>(fmlr[<span class="dv">2</span>])
    actual &lt;-<span class="st"> </span><span class="kw">eval</span>(<span class="kw">parse</span>(<span class="dt">text =</span> <span class="kw">paste0</span>(<span class="st">&#39;dat$</span><span class="ch">\&quot;</span><span class="st">&#39;</span>, response, <span class="st">&#39;</span><span class="ch">\&quot;</span><span class="st">&#39;</span>)))
    roc_result &lt;-<span class="st"> </span><span class="kw">roc</span>(actual, ests)
    roc_table &lt;-<span class="st"> </span><span class="kw">data.table</span>(
        <span class="dt">TPR =</span> roc_result<span class="op">$</span>sensitivities,
        <span class="dt">FPR =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>roc_result<span class="op">$</span>specificities,
        <span class="dt">thresholds =</span> roc_result<span class="op">$</span>thresholds
    )[
        <span class="kw">order</span>(TPR)
    ]
    <span class="kw">ggplot</span>(roc_table, <span class="kw">aes</span>(FPR, TPR, <span class="dt">label =</span> <span class="kw">round</span>(thresholds, <span class="dv">4</span>))) <span class="op">+</span>
<span class="st">        </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">        </span><span class="kw">geom_label_repel</span>(
            <span class="dt">box.padding =</span> <span class="fl">0.3</span>, 
            <span class="dt">point.padding =</span> <span class="fl">0.3</span>, 
            <span class="dt">segment.color =</span> <span class="st">&quot;grey50&quot;</span>
        ) <span class="op">+</span>
<span class="st">        </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">        </span><span class="kw">geom_segment</span>(
            <span class="kw">aes</span>(<span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">y =</span> <span class="dv">0</span>, <span class="dt">xend =</span> <span class="dv">1</span>, <span class="dt">yend =</span> <span class="dv">1</span>), 
            <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>
        ) <span class="op">+</span>
<span class="st">        </span><span class="kw">annotate</span>(
            <span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> .<span class="dv">05</span>, <span class="dt">hjust =</span> <span class="dv">1</span>, 
            <span class="dt">label =</span> <span class="kw">paste0</span>(
                <span class="st">&quot;AUC : &quot;</span>, <span class="kw">round</span>(<span class="kw">as.numeric</span>(<span class="kw">auc</span>(roc_result)), <span class="dv">4</span>)
            )
        ) <span class="op">+</span>
<span class="st">        </span><span class="kw">labs</span>(
            <span class="dt">x =</span> <span class="st">&quot;False positive rate&quot;</span>, 
            <span class="dt">y =</span> <span class="st">&quot;True positive rate&quot;</span>,
            <span class="dt">title =</span> <span class="st">&quot;ROC curve&quot;</span>, 
            <span class="dt">subtitle =</span> <span class="kw">paste0</span>(<span class="st">&quot;- &quot;</span>, response, <span class="st">&quot; ~ &quot;</span>, <span class="kw">as.character</span>(fmlr[<span class="dv">3</span>]))
        )
}</code></pre></div>
<p>Here are some examples of ROC curves:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># femsmoke_binary</span>
femsmoke_binary[, dead <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">ifelse</span>(dead <span class="op">==</span><span class="st"> &#39;yes&#39;</span>, <span class="dv">1</span>, <span class="dv">0</span>)]
<span class="kw">roc_curve</span>(dead <span class="op">~</span><span class="st"> </span>smoker <span class="op">+</span><span class="st"> </span>age, femsmoke_binary)</code></pre></div>
<p><img src="binarize_files/figure-html/eg3_2-1.png" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># rich_big</span>
is_rich &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dv">10000</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> .<span class="dv">5</span>)
gender &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dv">10000</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> .<span class="dv">5</span>)
criminal_record &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dv">10000</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> .<span class="dv">5</span>)
rich_big &lt;-<span class="st"> </span><span class="kw">data.table</span>(
    <span class="dt">gender =</span> <span class="kw">ifelse</span>(gender <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&#39;M&#39;</span>, <span class="st">&#39;F&#39;</span>),
    <span class="dt">criminal_record =</span> <span class="kw">ifelse</span>(criminal_record <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&#39;yes&#39;</span>, <span class="st">&#39;no&#39;</span>),
    <span class="dt">is_rich =</span> is_rich
)
<span class="kw">roc_curve</span>(is_rich <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>criminal_record, rich_big)</code></pre></div>
<p><img src="binarize_files/figure-html/eg3_2-2.png" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># nodal</span>
<span class="kw">roc_curve</span>(r <span class="op">~</span><span class="st"> </span>aged <span class="op">+</span><span class="st"> </span>stage <span class="op">+</span><span class="st"> </span>grade <span class="op">+</span><span class="st"> </span>xray <span class="op">+</span><span class="st"> </span>acid, nodal)</code></pre></div>
<p><img src="binarize_files/figure-html/eg3_2-3.png" style="display: block; margin: auto;" /></p>
</div>
<div id="confidence-interval-for-auc" class="section level2">
<h2>Confidence interval for AUC</h2>
<p>Using <code>boot::boot</code> and <code>boot::boot.ci</code>, we can compute the approximate CI for AUC:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">CI_auc &lt;-<span class="st"> </span><span class="cf">function</span>(fmlr, dat, <span class="dt">R =</span> <span class="dv">500</span>, <span class="dt">type =</span> <span class="st">&#39;norm&#39;</span>, ...) {
    <span class="co"># fmlr, dat: the same as in roc_curve</span>
    <span class="co"># R: the same as R in boot::boot</span>
    <span class="co"># type: the same as type in boot::boot.ci</span>
    <span class="co"># ...: additional arguments of boot::boot.ci</span>
    
    AUC_boot &lt;-<span class="st"> </span><span class="cf">function</span>(dat, i) {
        y &lt;-<span class="st"> </span>dat[i, ]
        mod &lt;-<span class="st"> </span><span class="kw">glm</span>(fmlr, <span class="dt">family =</span> binomial, <span class="dt">data =</span> y)
        ests &lt;-<span class="st"> </span><span class="kw">predict</span>(mod, <span class="dt">type =</span> <span class="st">&#39;response&#39;</span>)
        response &lt;-<span class="st"> </span><span class="kw">as.character</span>(fmlr[<span class="dv">2</span>])
        actual &lt;-<span class="st"> </span><span class="kw">eval</span>(<span class="kw">parse</span>(<span class="dt">text =</span> <span class="kw">paste0</span>(<span class="st">&#39;y$</span><span class="ch">\&quot;</span><span class="st">&#39;</span>, response, <span class="st">&#39;</span><span class="ch">\&quot;</span><span class="st">&#39;</span>)))
        <span class="kw">suppressMessages</span>(<span class="kw">as.numeric</span>(<span class="kw">auc</span>(<span class="kw">roc</span>(actual, ests))))
    }
    <span class="kw">boot.ci</span>(<span class="kw">boot</span>(dat, <span class="dt">statistic =</span> AUC_boot, <span class="dt">R =</span> R), <span class="dt">type =</span> type, ...)
}</code></pre></div>
<p>Examples are as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">CI_auc</span>(dead <span class="op">~</span><span class="st"> </span>smoker <span class="op">+</span><span class="st"> </span>age, femsmoke_binary)</code></pre></div>
<pre><code>## BOOTSTRAP CONFIDENCE INTERVAL CALCULATIONS
## Based on 500 bootstrap replicates
## 
## CALL : 
## boot.ci(boot.out = boot(dat, statistic = AUC_boot, R = R), type = type)
## 
## Intervals : 
## Level      Normal        
## 95%   ( 0.8697,  0.9077 )  
## Calculations and Intervals on Original Scale</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">CI_auc</span>(is_rich <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>criminal_record, rich_big, <span class="dt">R =</span> <span class="dv">200</span>)</code></pre></div>
<pre><code>## BOOTSTRAP CONFIDENCE INTERVAL CALCULATIONS
## Based on 200 bootstrap replicates
## 
## CALL : 
## boot.ci(boot.out = boot(dat, statistic = AUC_boot, R = R), type = type)
## 
## Intervals : 
## Level      Normal        
## 95%   ( 0.4969,  0.5128 )  
## Calculations and Intervals on Original Scale</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">CI_auc</span>(r <span class="op">~</span><span class="st"> </span>aged <span class="op">+</span><span class="st"> </span>stage <span class="op">+</span><span class="st"> </span>grade <span class="op">+</span><span class="st"> </span>xray <span class="op">+</span><span class="st"> </span>acid, nodal, <span class="dt">type =</span> <span class="st">&#39;perc&#39;</span>)</code></pre></div>
<pre><code>## BOOTSTRAP CONFIDENCE INTERVAL CALCULATIONS
## Based on 500 bootstrap replicates
## 
## CALL : 
## boot.ci(boot.out = boot(dat, statistic = AUC_boot, R = R), type = type)
## 
## Intervals : 
## Level     Percentile     
## 95%   ( 0.7728,  0.9735 )  
## Calculations and Intervals on Original Scale</code></pre>
</div>
</div>
<div id="aside-change_form" class="section level1">
<h1>4. Aside: <code>change_form</code></h1>
<p>The function <code>change_form</code> is designed to turn one form of data into another:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">change_form &lt;-<span class="st"> </span><span class="cf">function</span>(dat, from, to, 
                        old_response, category, new_response) {
    <span class="co"># dat: a data with categorical features; a response column/columns</span>
    <span class="co">#      must be numeric (0 and 1 if from = &#39;binary&#39;, or nonnegative </span>
    <span class="co">#      integers if from is either &#39;binomial&#39; or &#39;poisson&#39;). </span>
    <span class="co"># from: a character; either &#39;binary&#39;, &#39;binomial&#39;, or &#39;poisson&#39;</span>
    <span class="co"># to: a character != from; either &#39;binary&#39;, &#39;binomial&#39;, or &#39;poisson&#39;</span>
    <span class="co"># old_response: (always specified) a character vector of:</span>
    <span class="co">#     * length 1 if from = &#39;binary&#39; or &#39;poisson&#39;; the name of column</span>
    <span class="co">#       in dat that stores a response/count</span>
    <span class="co">#     * lenght 2 if from = &#39;binomial&#39;; the names of columns in dat</span>
    <span class="co">#       that store positive and negative case counts, in this order.</span>
    <span class="co"># category: (specified if to = &#39;poisson&#39;) a character vector of:</span>
    <span class="co">#     * length 1 if from = &#39;binomial&#39;; the new name of column that</span>
    <span class="co">#       will store two names in old_response</span>
    <span class="co">#     * length 2 if from = &#39;binary&#39;; the new names for positive and</span>
    <span class="co">#       negative cases in the binary response column, in this order.</span>
    <span class="co"># new_response: (specified only if from != &#39;poisson&#39;) a character </span>
    <span class="co">#               vector of:</span>
    <span class="co">#     * length 1 if to = &#39;binary&#39; or &#39;poisson&#39;; the name of the new</span>
    <span class="co">#       column in new data that will store either a binary or count </span>
    <span class="co">#       response</span>
    <span class="co">#     * length 2 if to = &#39;binomial&#39;; the names of two columns in</span>
    <span class="co">#       new data that will store positive and negative case counts,</span>
    <span class="co">#       in this order.</span>

    col_names &lt;-<span class="st"> </span><span class="kw">colnames</span>(dat)
    id_vars &lt;-<span class="st"> </span>col_names[<span class="op">!</span>(col_names <span class="op">%in%</span><span class="st"> </span>old_response)]
    id_vars_collapsed &lt;-<span class="st"> </span><span class="kw">paste0</span>(id_vars, <span class="dt">collapse =</span><span class="st">&#39;,&#39;</span>)
    <span class="cf">if</span> (from <span class="op">==</span><span class="st"> &#39;binary&#39;</span>) {
        <span class="cf">if</span> (to <span class="op">==</span><span class="st"> &#39;binomial&#39;</span>) {
            <span class="kw">return</span>(<span class="kw">eval</span>(<span class="kw">parse</span>(<span class="dt">text =</span> <span class="kw">paste0</span>(
                <span class="st">&#39;dat[, &#39;</span>,
                <span class="st">&#39;.(&#39;</span>, new_response[<span class="dv">1</span>] , <span class="st">&#39; = sum(&#39;</span>, old_response, <span class="st">&#39;), &#39;</span>,
                new_response[<span class="dv">2</span>], <span class="st">&#39; = sum(!&#39;</span>, old_response, <span class="st">&#39;)), &#39;</span>,
                <span class="st">&#39;by = </span><span class="ch">\&quot;</span><span class="st">&#39;</span>, id_vars_collapsed, <span class="st">&#39;</span><span class="ch">\&quot;</span><span class="st">]&#39;</span>
            ))))
        } <span class="cf">else</span> <span class="cf">if</span> (to <span class="op">==</span><span class="st"> &#39;poisson&#39;</span>) {
            dat &lt;-<span class="st"> </span><span class="kw">eval</span>(<span class="kw">parse</span>(<span class="dt">text =</span> <span class="kw">paste0</span>(
                <span class="st">&#39;dat[, &#39;</span>,
                <span class="st">&#39;.(&#39;</span>, category[<span class="dv">1</span>] , <span class="st">&#39; = sum(&#39;</span>, old_response, <span class="st">&#39;), &#39;</span>,
                category[<span class="dv">2</span>], <span class="st">&#39; = sum(!&#39;</span>, old_response, <span class="st">&#39;)), &#39;</span>,
                <span class="st">&#39;by = </span><span class="ch">\&quot;</span><span class="st">&#39;</span>, id_vars_collapsed, <span class="st">&#39;</span><span class="ch">\&quot;</span><span class="st">]&#39;</span>
            )))
            <span class="kw">return</span>(<span class="kw">suppressWarnings</span>(<span class="kw">melt</span>(
                dat,
                <span class="dt">id.vars =</span> id_vars,
                <span class="dt">variable.name =</span> old_response,
                <span class="dt">value.name =</span> new_response
            )))
        } <span class="cf">else</span> {
            <span class="kw">stop</span>(
                <span class="st">&#39;</span><span class="ch">\&quot;</span><span class="st">to</span><span class="ch">\&quot;</span><span class="st"> must be either </span><span class="ch">\&quot;</span><span class="st">binomial</span><span class="ch">\&quot;</span><span class="st"> or </span><span class="ch">\&quot;</span><span class="st">poisson</span><span class="ch">\&quot;</span><span class="st">&#39;</span>,
                <span class="st">&#39; if </span><span class="ch">\&quot;</span><span class="st">from</span><span class="ch">\&quot;</span><span class="st"> = </span><span class="ch">\&quot;</span><span class="st">binary</span><span class="ch">\&quot;</span><span class="st">&#39;</span>
            )
        }
    } <span class="cf">else</span> <span class="cf">if</span> (from <span class="op">==</span><span class="st"> &#39;binomial&#39;</span>) {
        <span class="cf">if</span> (to <span class="op">==</span><span class="st"> &#39;binary&#39;</span>) {
            <span class="kw">return</span>(<span class="kw">binarize_binom</span>(dat, old_response, new_response))
        } <span class="cf">else</span> <span class="cf">if</span> (to <span class="op">==</span><span class="st"> &#39;poisson&#39;</span>) {
            <span class="kw">melt</span>(
                dat,
                <span class="dt">id.vars =</span> id_vars,
                <span class="dt">variable.name =</span> category,
                <span class="dt">value.name =</span> new_response
            )
        } <span class="cf">else</span> {
            <span class="kw">stop</span>(
                <span class="st">&#39;</span><span class="ch">\&quot;</span><span class="st">to</span><span class="ch">\&quot;</span><span class="st"> must be either </span><span class="ch">\&quot;</span><span class="st">binary</span><span class="ch">\&quot;</span><span class="st"> or </span><span class="ch">\&quot;</span><span class="st">poisson</span><span class="ch">\&quot;</span><span class="st">&#39;</span>,
                <span class="st">&#39; if </span><span class="ch">\&quot;</span><span class="st">from</span><span class="ch">\&quot;</span><span class="st"> = </span><span class="ch">\&quot;</span><span class="st">binomial</span><span class="ch">\&quot;</span><span class="st">&#39;</span>
            )
        }
    } <span class="cf">else</span> <span class="cf">if</span> (from <span class="op">==</span><span class="st"> &#39;poisson&#39;</span>) {
        <span class="cf">if</span> (to <span class="op">==</span><span class="st"> &#39;binary&#39;</span>) {
            <span class="kw">return</span>(<span class="kw">binarize_pois</span>(dat, old_response))
        } <span class="cf">else</span> <span class="cf">if</span> (to <span class="op">==</span><span class="st"> &#39;binomial&#39;</span>) {
            id_vars &lt;-<span class="st"> </span>id_vars[<span class="op">!</span>(id_vars <span class="op">%in%</span><span class="st"> </span>category)]
            id_vars_fmlr &lt;-<span class="st"> </span><span class="kw">paste0</span>(id_vars, <span class="dt">collapse =</span> <span class="st">&#39; + &#39;</span>)
            fmlr &lt;-<span class="st"> </span><span class="kw">as.formula</span>(<span class="kw">paste0</span>(id_vars_fmlr, <span class="st">&#39; ~ &#39;</span>, category))
            <span class="kw">return</span>(<span class="kw">dcast</span>(dat, fmlr, <span class="dt">value.var =</span> old_response))
        } <span class="cf">else</span> {
            <span class="kw">stop</span>(
                <span class="st">&#39;</span><span class="ch">\&quot;</span><span class="st">to</span><span class="ch">\&quot;</span><span class="st"> must be either </span><span class="ch">\&quot;</span><span class="st">binary</span><span class="ch">\&quot;</span><span class="st"> or </span><span class="ch">\&quot;</span><span class="st">binomial</span><span class="ch">\&quot;</span><span class="st">&#39;</span>,
                <span class="st">&#39; if </span><span class="ch">\&quot;</span><span class="st">from</span><span class="ch">\&quot;</span><span class="st"> = </span><span class="ch">\&quot;</span><span class="st">poisson</span><span class="ch">\&quot;</span><span class="st">&#39;</span>
            )
        }
    } <span class="cf">else</span> {
        <span class="kw">stop</span>(<span class="kw">paste0</span>(
            <span class="st">&#39;</span><span class="ch">\&quot;</span><span class="st">from</span><span class="ch">\&quot;</span><span class="st"> must be either&#39;</span>, 
            <span class="st">&#39; </span><span class="ch">\&quot;</span><span class="st">binary</span><span class="ch">\&quot;</span><span class="st">, </span><span class="ch">\&quot;</span><span class="st">binomial</span><span class="ch">\&quot;</span><span class="st">, or </span><span class="ch">\&quot;</span><span class="st">poisson</span><span class="ch">\&quot;</span><span class="st">&#39;</span>
        ))
    }
}</code></pre></div>
<p>Examples are as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">change_form</span>(
    rich,
    <span class="dt">from =</span> <span class="st">&#39;binary&#39;</span>, <span class="dt">to =</span> <span class="st">&#39;binomial&#39;</span>,
    <span class="dt">old_response =</span> <span class="st">&#39;is_rich&#39;</span>,
    <span class="dt">new_response =</span> <span class="kw">c</span>(<span class="st">&#39;rich&#39;</span>, <span class="st">&#39;not_rich&#39;</span>)
)</code></pre></div>
<pre><code>##    gender criminal_record rich not_rich
## 1:      F              no    0        3
## 2:      M              no    2        1
## 3:      M             yes    0        2
## 4:      F             yes    2        0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">change_form</span>(
    rich,
    <span class="dt">from =</span> <span class="st">&#39;binary&#39;</span>, <span class="dt">to =</span> <span class="st">&#39;poisson&#39;</span>,
    <span class="dt">old_response =</span> <span class="st">&#39;is_rich&#39;</span>,
    <span class="dt">category =</span> <span class="kw">c</span>(<span class="st">&#39;rich&#39;</span>, <span class="st">&#39;not_rich&#39;</span>),
    <span class="dt">new_response =</span> <span class="st">&#39;count&#39;</span>
)</code></pre></div>
<pre><code>##    gender criminal_record  is_rich count
## 1:      F              no     rich     0
## 2:      M              no     rich     2
## 3:      M             yes     rich     0
## 4:      F             yes     rich     2
## 5:      F              no not_rich     3
## 6:      M              no not_rich     1
## 7:      M             yes not_rich     2
## 8:      F             yes not_rich     0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nodal &lt;-<span class="st"> </span>nodal[, <span class="op">-</span><span class="dv">1</span>]
<span class="kw">as_tibble</span>(<span class="kw">change_form</span>(
    nodal, 
    <span class="dt">from =</span> <span class="st">&#39;binary&#39;</span>, <span class="dt">to =</span> <span class="st">&#39;poisson&#39;</span>, 
    <span class="dt">old_response =</span> <span class="st">&#39;r&#39;</span>, 
    <span class="dt">category =</span> <span class="kw">c</span>(<span class="st">&#39;yes&#39;</span>, <span class="st">&#39;no&#39;</span>), 
    <span class="dt">new_response =</span> <span class="st">&#39;count&#39;</span>
))</code></pre></div>
<pre><code>## # A tibble: 46 x 7
##    aged  stage grade xray  acid  r     count
##    &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt;
##  1 0     1     1     1     1     yes       5
##  2 0     0     0     0     1     yes       1
##  3 1     1     1     0     0     yes       0
##  4 1     1     0     0     1     yes       2
##  5 0     0     0     0     0     yes       0
##  6 0     1     1     0     1     yes       2
##  7 1     1     0     0     0     yes       1
##  8 1     0     0     0     1     yes       0
##  9 1     0     0     0     0     yes       0
## 10 1     0     0     1     0     yes       0
## # ... with 36 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">change_form</span>(
    rich_binom,
    <span class="dt">from =</span> <span class="st">&#39;binomial&#39;</span>, <span class="dt">to =</span> <span class="st">&#39;binary&#39;</span>,
    <span class="dt">old_response =</span> <span class="kw">c</span>(<span class="st">&#39;rich&#39;</span>, <span class="st">&#39;not_rich&#39;</span>),
    <span class="dt">new_response =</span> <span class="st">&#39;is_rich&#39;</span>
)</code></pre></div>
<pre><code>##     gender criminal_record  is_rich
##  1:      F             yes     rich
##  2:      F             yes     rich
##  3:      M              no     rich
##  4:      M              no     rich
##  5:      F              no not_rich
##  6:      F              no not_rich
##  7:      F              no not_rich
##  8:      M              no not_rich
##  9:      M             yes not_rich
## 10:      M             yes not_rich</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">change_form</span>(
    rich_binom,
    <span class="dt">from =</span> <span class="st">&#39;binomial&#39;</span>, <span class="dt">to =</span> <span class="st">&#39;poisson&#39;</span>,
    <span class="dt">old_response =</span> <span class="kw">c</span>(<span class="st">&#39;rich&#39;</span>, <span class="st">&#39;not_rich&#39;</span>),
    <span class="dt">category =</span> <span class="st">&#39;is_rich&#39;</span>,
    <span class="dt">new_response =</span> <span class="st">&#39;count&#39;</span>
)</code></pre></div>
<pre><code>##    gender criminal_record  is_rich count
## 1:      F              no     rich     0
## 2:      F             yes     rich     2
## 3:      M              no     rich     2
## 4:      M             yes     rich     0
## 5:      F              no not_rich     3
## 6:      F             yes not_rich     0
## 7:      M              no not_rich     1
## 8:      M             yes not_rich     2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">change_form</span>(
    rich_pois,
    <span class="dt">from =</span> <span class="st">&#39;poisson&#39;</span>, <span class="dt">to =</span> <span class="st">&#39;binary&#39;</span>,
    <span class="dt">old_response =</span> <span class="st">&#39;count&#39;</span>
)</code></pre></div>
<pre><code>##     gender criminal_record  is_rich
##  1:      F             yes     rich
##  2:      F             yes     rich
##  3:      M              no     rich
##  4:      M              no     rich
##  5:      F              no not_rich
##  6:      F              no not_rich
##  7:      F              no not_rich
##  8:      M              no not_rich
##  9:      M             yes not_rich
## 10:      M             yes not_rich</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">change_form</span>(
    rich_pois,
    <span class="dt">from =</span> <span class="st">&#39;poisson&#39;</span>, <span class="dt">to =</span> <span class="st">&#39;binomial&#39;</span>,
    <span class="dt">old_response =</span> <span class="st">&#39;count&#39;</span>,
    <span class="dt">category =</span> <span class="st">&#39;is_rich&#39;</span>
)</code></pre></div>
<pre><code>##    gender criminal_record rich not_rich
## 1:      F              no    0        3
## 2:      F             yes    2        0
## 3:      M              no    2        1
## 4:      M             yes    0        2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">change_form</span>(
    femsmoke,
    <span class="dt">from =</span> <span class="st">&#39;poisson&#39;</span>, <span class="dt">to =</span> <span class="st">&#39;binomial&#39;</span>,
    <span class="dt">old_response =</span> <span class="st">&#39;y&#39;</span>,
    <span class="dt">category =</span> <span class="st">&#39;dead&#39;</span>
) <span class="co"># i.e. yes if dead, no if alive</span></code></pre></div>
<pre><code>##     smoker   age yes  no
##  1:    yes 18-24   2  53
##  2:    yes 25-34   3 121
##  3:    yes 35-44  14  95
##  4:    yes 45-54  27 103
##  5:    yes 55-64  51  64
##  6:    yes 65-74  29   7
##  7:    yes   75+  13   0
##  8:     no 18-24   1  61
##  9:     no 25-34   5 152
## 10:     no 35-44   7 114
## 11:     no 45-54  12  66
## 12:     no 55-64  40  81
## 13:     no 65-74 101  28
## 14:     no   75+  64   0</code></pre>
</div>
<div id="session-info" class="section level1">
<h1>Session info</h1>
<p>R session info:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sessionInfo</span>()</code></pre></div>
<pre><code>## R version 3.6.0 (2019-04-26)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 10 x64 (build 17763)
## 
## Matrix products: default
## 
## locale:
## [1] LC_COLLATE=English_Canada.1252  LC_CTYPE=English_Canada.1252   
## [3] LC_MONETARY=English_Canada.1252 LC_NUMERIC=C                   
## [5] LC_TIME=English_Canada.1252    
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] pROC_1.15.0       ggrepel_0.8.1     ggplot2_3.1.1     funpark_0.1.0    
## [5] data.table_1.12.2 boot_1.3-22      
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.1       compiler_3.6.0   pillar_1.4.1     plyr_1.8.4      
##  [5] prettydoc_0.2.1  tools_3.6.0      zeallot_0.1.0    digest_0.6.19   
##  [9] evaluate_0.14    tibble_2.1.3     gtable_0.3.0     pkgconfig_2.0.2 
## [13] rlang_0.3.4      cli_1.1.0        yaml_2.2.0       xfun_0.7        
## [17] withr_2.1.2      stringr_1.4.0    dplyr_0.8.1      knitr_1.23      
## [21] vctrs_0.1.0      grid_3.6.0       tidyselect_0.2.5 glue_1.3.1      
## [25] R6_2.4.0         fansi_0.4.0      rmarkdown_1.13   purrr_0.3.2     
## [29] magrittr_1.5     backports_1.1.4  scales_1.0.0     htmltools_0.3.6 
## [33] assertthat_0.2.1 colorspace_1.4-1 labeling_0.3     utf8_1.1.4      
## [37] stringi_1.4.3    lazyeval_0.2.2   munsell_0.5.0    crayon_1.3.4</code></pre>
</div>
<div id="related-pages" class="section level1">
<h1>Related pages</h1>
<ul>
<li><a href="https://stackoverflow.com/questions/18154556/split-text-string-in-a-data-table-columns">About <code>data.table::tstrsplit</code></a></li>
</ul>
</div>
</section>

<!-- Footer -->
<!-- Reference: https://holtzy.github.io/Pimp-my-rmd/ -->
&nbsp; <!-- whitespace -->
<hr /> <!-- line -->
<div class="footer">
    <p style="text-align: center;">
        <a href="../../index.html" style="font-size: 11pt;">Home</a> · <a href="../../projects.html" style="font-size: 11pt;">Projects</a> · <a href="../../research_materials.html" style="font-size: 11pt;">Research materials</a> · <a href="../../news.html" style="font-size: 11pt;">News</a> · <a href="../../files/cv_junkyu_park.pdf" style="font-size: 11pt;">CV</a>
    </p>
    <p style="text-align: center;">
        © 2019 Junkyu Park<br>Powered by the <a href="https://github.com/yixuan/prettydoc">prettydoc::html_pretty</a> engine<br>Current theme: modified <a href="https://github.com/jasonlong/cayman-theme">Cayman</a>
    </p>
            
    <!-- Add icon library -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
            
    <!-- Add font awesome icons -->
    <p style="text-align: center;">
        <span style="color: #555555;"><em>joon3216@gmail.com</em></span>
        <br>
        <a href="https://www.facebook.com/asdfzxcvjkl1" class="fa fa-facebook"></a>
        <a href="https://github.com/joon3216" class="fa fa-github"></a>
        <a href="https://linkedin.com/in/asdfzxcvjkl1/" class="fa fa-linkedin"></a>
        <a href="https://twitter.com/joon3216" class="fa fa-twitter"></a>
    </p>
</div>
&nbsp; <!-- whitespace -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
